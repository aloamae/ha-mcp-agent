# ========================================
# DASHBOARD DE DEBUGGING - MODES CHAUFFAGE
# ========================================
#
# Ce dashboard affiche en temps r√©el:
# - √âtat de tous les modes de chauffage
# - Priorit√© active actuellement
# - Temp√©ratures et consignes
# - Logs des automations
# - Tests et diagnostics
#
# ========================================

title: Debug Chauffage
path: debug-chauffage
icon: mdi:bug
badges: []
cards:

  # ========================================
  # SECTION 1: √âTAT DES MODES (PRIORIT√â)
  # ========================================

  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          # üéØ ORDRE DE PRIORIT√â ACTUEL

          Les modes sont list√©s du plus prioritaire au moins prioritaire.
          Le premier mode actif **prend le contr√¥le**.

      # PRIORIT√â 1: MODE VACANCES
      - type: conditional
        conditions:
          - entity: input_boolean.mode_vacance
            state: "on"
        card:
          type: entities
          title: "1Ô∏è‚É£ MODE VACANCES (ACTIF)"
          state_color: true
          entities:
            - entity: input_boolean.mode_vacance
              name: Mode Vacances
              icon: mdi:palm-tree
            - type: section
              label: "‚ö†Ô∏è CONSIGNE FORC√âE: 16¬∞C (hors-gel)"
            - type: section
              label: "‚ùå Planning horaire BLOQU√â"
            - type: button
              name: D√©sactiver le mode vacances
              icon: mdi:close-circle
              tap_action:
                action: call-service
                service: input_boolean.turn_off
                service_data:
                  entity_id: input_boolean.mode_vacance
          card_mod:
            style: |
              ha-card {
                border: 3px solid red;
                background: rgba(255,0,0,0.1);
              }

      - type: conditional
        conditions:
          - entity: input_boolean.mode_vacance
            state: "off"
        card:
          type: entities
          title: "1Ô∏è‚É£ MODE VACANCES (Inactif)"
          entities:
            - entity: input_boolean.mode_vacance
              name: Mode Vacances
              icon: mdi:palm-tree

      # PRIORIT√â 2: MODES MANUELS PAR PI√àCE
      - type: entities
        title: "2Ô∏è‚É£ MODES MANUELS PAR PI√àCE"
        state_color: true
        entities:
          - entity: input_select.mode_chauffage_salon
            name: Salon
            icon: mdi:sofa
          - entity: input_select.mode_chauffage_cuisine
            name: Cuisine
            icon: mdi:silverware-fork-knife
          - type: section
            label: "‚ÑπÔ∏è Prioritaire sur planning horaire"

      # PRIORIT√â 3: MODE PR√âSENCE
      - type: entities
        title: "3Ô∏è‚É£ MODE PR√âSENCE"
        state_color: true
        entities:
          - entity: zone.home
            name: Nombre de personnes
            icon: mdi:home-account
          - type: attribute
            entity: zone.home
            attribute: persons
            name: Personnes pr√©sentes
          - type: conditional
            conditions:
              - entity: zone.home
                state: "0"
            row:
              type: section
              label: "‚ö†Ô∏è ABSENCE D√âTECT√âE ‚Üí Mode √âco"
          - type: section
            label: "Automation: Chauffage Auto - Pr√©sence"

      # PRIORIT√â 4: PLANNING HORAIRE
      - type: entities
        title: "4Ô∏è‚É£ MODE PLANNING HORAIRE"
        state_color: true
        entities:
          - entity: automation.chauffage_planning_automatique_horaire
            name: Planning automatique
            icon: mdi:clock-outline
          - entity: input_boolean.mode_nuit
            name: Mode Nuit
            icon: mdi:weather-night
          - type: section
            label: "Horaires:"
          - type: attribute
            entity: automation.chauffage_planning_automatique_horaire
            attribute: last_triggered
            name: Dernier d√©clenchement
          - type: section
            label: "05:45 ‚Üí 19¬∞C (Confort matin)"
          - type: section
            label: "08:00 ‚Üí 18.5¬∞C (√âco journ√©e)"
          - type: section
            label: "17:00 ‚Üí 19¬∞C (Confort soir)"
          - type: section
            label: "22:30 ‚Üí 16¬∞C (Hors-gel nuit)"

      # PRIORIT√â 5: MODE CHAUFFAGE GLOBAL
      - type: entities
        title: "5Ô∏è‚É£ MODE CHAUFFAGE GLOBAL"
        entities:
          - entity: sensor.mode_chauffage_global
            name: Consigne globale
            icon: mdi:thermometer

  # ========================================
  # SECTION 2: PILOTAGE CHAUDI√àRE (EX√âCUTION)
  # ========================================

  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          # üî• PILOTAGE CHAUDI√àRE (EX√âCUTION)

          Automation qui s'ex√©cute **toutes les 3 minutes**.

      - type: entities
        title: "6Ô∏è‚É£ Chauffage - Pilotage Chaudi√®re GAZ"
        state_color: true
        entities:
          - entity: automation.chauffage_pilotage_chaudiere_gaz
            name: Automation pilotage
            icon: mdi:fire
          - entity: switch.thermostat
            name: Chaudi√®re
            icon: mdi:radiator
          - type: attribute
            entity: automation.chauffage_pilotage_chaudiere_gaz
            attribute: last_triggered
            name: Dernier cycle
          - type: section
            label: "Seuils: ¬±0.5¬∞C (modifi√©s)"

  # ========================================
  # SECTION 3: TEMP√âRATURES TEMPS R√âEL
  # ========================================

  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          # üå°Ô∏è TEMP√âRATURES ET CONSIGNES

      - type: entities
        title: Cuisine
        entities:
          - entity: sensor.th_cuisine_temperature
            name: Temp√©rature actuelle
            icon: mdi:thermometer
          - entity: climate.popp_wireless_thermostatic_valve_trv
            name: Consigne TRV
            icon: mdi:target
          - type: custom:bar-card
            entity: sensor.th_cuisine_temperature
            min: 15
            max: 25
            severity:
              - value: 16
                color: blue
              - value: 18
                color: cyan
              - value: 19
                color: green
              - value: 20
                color: orange
              - value: 22
                color: red

      - type: entities
        title: Chambre Parents
        entities:
          - entity: sensor.th_parents_temperature
            name: Temp√©rature actuelle
          - entity: climate.popp_wireless_thermostatic_valve_trv_2
            name: Consigne TRV
          - type: custom:bar-card
            entity: sensor.th_parents_temperature
            min: 15
            max: 25
            severity:
              - value: 16
                color: blue
              - value: 18
                color: cyan
              - value: 19
                color: green
              - value: 20
                color: orange
              - value: 22
                color: red

      - type: entities
        title: Chambre Loann
        entities:
          - entity: sensor.th_loann_temperature
            name: Temp√©rature actuelle
          - entity: climate.popp_wireless_thermostatic_valve_trv_3
            name: Consigne TRV
          - type: custom:bar-card
            entity: sensor.th_loann_temperature
            min: 15
            max: 25
            severity:
              - value: 16
                color: blue
              - value: 18
                color: cyan
              - value: 19
                color: green
              - value: 20
                color: orange
              - value: 22
                color: red

  # ========================================
  # SECTION 4: CALCUL TEMPS R√âEL
  # ========================================

  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          # üßÆ CALCUL DE LA CONSIGNE ACTIVE

          Consigne calcul√©e selon l'ordre de priorit√©.

      - type: entities
        title: Calcul actuel
        entities:
          - type: conditional
            conditions:
              - entity: input_boolean.mode_vacance
                state: "on"
            row:
              type: section
              label: "üèñÔ∏è Mode Vacances ‚Üí 16¬∞C"
          - type: conditional
            conditions:
              - entity: input_boolean.mode_vacance
                state: "off"
            row:
              entity: sensor.mode_chauffage_global
              name: "Consigne active"
              icon: mdi:target

      - type: markdown
        content: |
          ### Logique de d√©cision:

          ```
          SI mode_vacance = ON
            ‚Üí 16¬∞C (hors-gel)

          SINON SI mode_manuel_piece d√©fini
            ‚Üí Consigne manuelle

          SINON SI pr√©sence = 0
            ‚Üí 18.5¬∞C (√âco)

          SINON SI planning_horaire actif
            ‚Üí Consigne planning

          SINON
            ‚Üí sensor.mode_chauffage_global
          ```

  # ========================================
  # SECTION 5: TESTS ET DIAGNOSTICS
  # ========================================

  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          # üß™ TESTS ET DIAGNOSTICS

      - type: entities
        title: Actions rapides
        entities:
          - type: button
            name: "Test: Activer Mode Vacances"
            icon: mdi:palm-tree
            tap_action:
              action: call-service
              service: input_boolean.turn_on
              service_data:
                entity_id: input_boolean.mode_vacance
          - type: button
            name: "Test: D√©sactiver Mode Vacances"
            icon: mdi:home
            tap_action:
              action: call-service
              service: input_boolean.turn_off
              service_data:
                entity_id: input_boolean.mode_vacance
          - type: button
            name: "Test: Forcer ex√©cution Planning"
            icon: mdi:play-circle
            tap_action:
              action: call-service
              service: automation.trigger
              service_data:
                entity_id: automation.chauffage_planning_automatique_horaire
          - type: button
            name: "Test: Forcer ex√©cution Chaudi√®re"
            icon: mdi:fire
            tap_action:
              action: call-service
              service: automation.trigger
              service_data:
                entity_id: automation.chauffage_pilotage_chaudiere_gaz

      - type: entities
        title: √âtat des automations
        show_header_toggle: false
        entities:
          - entity: automation.chauffage_planning_automatique_horaire
            name: Planning horaire
          - entity: automation.chauffage_pilotage_chaudiere_gaz
            name: Pilotage chaudi√®re
          - entity: automation.chauffage_allumage_general_matin
            name: Allumage matin
          - entity: automation.chauffage_auto_presence
            name: Auto pr√©sence

  # ========================================
  # SECTION 6: LOGS ET HISTORIQUE
  # ========================================

  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          # üìú LOGS ET HISTORIQUE

      - type: logbook
        entities:
          - automation.chauffage_planning_automatique_horaire
          - automation.chauffage_pilotage_chaudiere_gaz
          - input_boolean.mode_vacance
          - switch.thermostat
        hours_to_show: 6
        title: Derni√®res 6 heures

      - type: history-graph
        title: Temp√©ratures 24h
        hours_to_show: 24
        entities:
          - sensor.th_cuisine_temperature
          - sensor.th_parents_temperature
          - sensor.th_loann_temperature

      - type: history-graph
        title: √âtat chaudi√®re 24h
        hours_to_show: 24
        entities:
          - switch.thermostat

  # ========================================
  # SECTION 7: SC√âNARIOS DE TEST
  # ========================================

  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          # üé¨ SC√âNARIOS DE TEST

          Utilise ces boutons pour tester les diff√©rents sc√©narios.

      - type: entities
        title: "Sc√©nario 1: Absence compl√®te"
        entities:
          - type: button
            name: "Simuler absence (zone.home = 0)"
            icon: mdi:home-export-outline
            tap_action:
              action: navigate
              navigation_path: /developer-tools/service
          - type: section
            label: "R√©sultat attendu: Salon ‚Üí √âco (18.5¬∞C)"

      - type: entities
        title: "Sc√©nario 2: Retour de pr√©sence"
        entities:
          - type: button
            name: "Simuler retour (zone.home > 0)"
            icon: mdi:home-import-outline
            tap_action:
              action: navigate
              navigation_path: /developer-tools/service
          - type: section
            label: "R√©sultat attendu: Restaurer consigne planning"

      - type: entities
        title: "Sc√©nario 3: Mode manuel + Absence"
        entities:
          - type: section
            label: "1. D√©finir mode manuel Salon"
          - entity: input_select.mode_chauffage_salon
          - type: section
            label: "2. Simuler absence"
          - type: section
            label: "Question: Quel mode prioritaire?"

  # ========================================
  # SECTION 8: DOCUMENTATION
  # ========================================

  - type: markdown
    content: |
      # üìö DOCUMENTATION ORDRE DE PRIORIT√â

      ## Hi√©rarchie des modes:

      ```
      1Ô∏è‚É£ MODE VACANCES
         ‚îî‚îÄ> Si ON: Force 16¬∞C, bloque TOUT
         ‚îî‚îÄ> D√©sactive: Planning, Modes manuels

      2Ô∏è‚É£ MODE MANUEL PAR PI√àCE
         ‚îî‚îÄ> Override local (Salon, Cuisine)
         ‚îî‚îÄ> Prioritaire sur planning
         ‚îî‚îÄ> Affect√© par mode pr√©sence

      3Ô∏è‚É£ MODE PR√âSENCE
         ‚îî‚îÄ> Si absence (zone.home = 0)
         ‚îî‚îÄ> Action: Salon ‚Üí √âco (18.5¬∞C)
         ‚îî‚îÄ> Question: Retour automatique?

      4Ô∏è‚É£ MODE PLANNING HORAIRE
         ‚îî‚îÄ> 4 horaires: 05:45, 08:00, 17:00, 22:30
         ‚îî‚îÄ> Bloqu√© si mode_vacance = ON
         ‚îî‚îÄ> D√©finit consignes TRV

      5Ô∏è‚É£ MODE CHAUFFAGE GLOBAL
         ‚îî‚îÄ> sensor.mode_chauffage_global
         ‚îî‚îÄ> Consigne par d√©faut
         ‚îî‚îÄ> Agr√®ge modes sup√©rieurs

      6Ô∏è‚É£ PILOTAGE CHAUDI√àRE
         ‚îî‚îÄ> Ex√©cution toutes les 3 min
         ‚îî‚îÄ> Seuils: ¬±0.5¬∞C (modifi√©s)
         ‚îî‚îÄ> Lit consigne finale
      ```

      ## Seuils temp√©rature (MODIFI√âS):

      - **Allume** si delta ‚â• **+0.5¬∞C**
      - **√âteint** si delta ‚â§ **-0.5¬∞C**
      - **Zone morte**: Maintien √©tat actuel

      ## Questions √† clarifier:

      1. **Mode pr√©sence:**
         - Automation de retour?
         - Autres pi√®ces que Salon?
         - Conflit avec mode manuel?

      2. **Mode manuel par pi√®ce:**
         - Priorit√© sur planning? (√† confirmer)
         - Restauration automatique?

      3. **sensor.mode_chauffage_global:**
         - Comment calcul√©?
         - Template sensor ou helper?

# ========================================
# INSTALLATION
# ========================================
#
# 1. Copier ce fichier dans /config/ui-lovelace.yaml
#    OU
# 2. Ajouter comme nouvelle vue dans dashboard existant
# 3. Adapter les noms d'entit√©s si diff√©rents
# 4. Installer card-mod (HACS) pour les styles (optionnel)
# 5. Installer bar-card (HACS) pour les graphes (optionnel)
#
# ========================================
